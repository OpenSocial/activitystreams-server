var app=function(a,b){var c=function(b,c){var d=function(b){a.ajax({url:"/activitystreams/"+app.common.userID,type:"POST",data:b,success:function(a){a.success?(app.common.actionsErrorArea.parent().addClass("hidden"),b.actor={id:app.common.userID,displayName:app.common.userName},b._id=a.activityID,app.activityStreams.prependActivity(app.common.myActivityStreamsArea,b,app.common.myActivityStreamsArea.find("tr").size()),app.common.socket.emit("userAddedActivity",app.common.userID,b)):app.common.actionsErrorArea.text(a.error).parent().removeClass("hidden")},error:function(){app.common.actionsErrorArea.text("Unexpected error occured.").parent().removeClass("hidden")}})},e=function(){var a=app.common.objectName.val();if(a=a.replace(/\\/gm,"\\").replace(/"/gm,'"'),""!==a){var e=asms.Activity({verb:b,published:(new Date).toISOString(),object:{objectType:c,displayName:a}}),f=e.__wrapped__;d(f),app.common.nameDialog.modal("hide"),app.common.addActivityButton.off("click")}else app.common.nameDialogErrorArea.text("Please, enter the name to proceed").parent().removeClass("hidden")},f=function(){var a=app.dictionary.verbs[b];app.common.nameDialogLabel.text("like"===c?"Please, enter the name of the object you "+a+" "+c+" to":"Please, enter the name of the "+c+" you "+a),app.common.objectImage.removeClass().addClass("glyphicon "+app.dictionary.objectTypes[c]),app.common.objectName.val(""),app.common.nameDialogErrorArea.parent().addClass("hidden"),app.common.nameDialog.modal(),app.common.addActivityButton.on("click",e)};f()};return b.actions={postPhoto:function(){c("post","photo")},postVideo:function(){c("post","video")},postNote:function(){c("post","note")},recommendPlace:function(){c("recommend","place")},postAudio:function(){c("post","audio")},addLike:function(){c("add","like")}},b}(jQuery,app||{}),app=function(a,b){var c=function(){var b=a(this).text(),c=app.dictionary.actions[b];a.ajax({url:c.url,type:c.method,data:{action:b},success:function(b){b.success?(app.common.activityStreamsErrorArea.parent().addClass("hidden"),a.bootstrapGrowl(b.success,{type:"success"})):app.common.activityStreamsErrorArea.text(b.error).parent().removeClass("hidden")},error:function(){app.common.activityStreamsErrorArea.text("Unexpected error occured.").parent().removeClass("hidden")}})},d=function(b,d,e){b===app.common.myActivityStreamsArea?(0===app.common.myActivityStreamsAreaCount&&b.empty(),app.common.myActivityStreamsAreaCount++):b===app.common.followingsActivityStreamsArea&&(0===app.common.followingsActivityStreamsAreaCount&&b.empty(),app.common.followingsActivityStreamsAreaCount++);var f,g="<tr class='success'><input type='hidden' id='actorID"+e+"' value='"+d.actor.id+"'><td><div class='row'><div class='col-md-1'><span class='glyphicon "+app.dictionary.objectTypes[d.object.objectType]+"'></span></div><div class='col-md-3'><small><abbr class='timeago' title='"+d.published+"'></abbr></small></div><div class='col-md-8'><strong>"+d.actor.displayName+"</strong> "+app.dictionary.verbs[d.verb]+" <strong>"+d.object.objectType+'</strong> "'+d.object.displayName+'"</div></div>',h=app.dictionary.actions;if(!a.isEmptyObject(h)){g+="<div class='row'><div class='col-md-8 col-md-offset-4'><div class='pull-right'>";for(f in h)h.hasOwnProperty(f)&&(g+="<button type='button' id='"+f+"ActionHandler"+e+"' class='btn btn-primary btn-xs'>"+f+"</button>&nbsp;");g+="</div></div></div>"}if(g+="</td></tr>",b.prepend(g),setTimeout(function(){a("input[id='actorID"+e+"']").parent().removeClass("success")},3e3),a("abbr.timeago").timeago(),!a.isEmptyObject(h))for(f in h)h.hasOwnProperty(f)&&a("#"+f+"ActionHandler"+e).click(c)},e=function(a,b){for(var c=0,e=b.items.length;e>c;c++){var f=b.items[c];d(a,f,c)}};return b.activityStreams={prependActivity:d,displayActivityStreams:function(b,c,d){a.ajax({url:"/activitystreams/"+c,type:"GET",success:function(a){a.success?(app.common.activityStreamsErrorArea.parent().addClass("hidden"),a.items.length>0&&(d&&b.empty(),e(b,a))):app.common.activityStreamsErrorArea.text(a.error).parent().removeClass("hidden")},error:function(){app.common.activityStreamsErrorArea.text("Unexpected error occured.").parent().removeClass("hidden")}})}},b}(jQuery,app||{}),app=function(a,b){return b.common={socket:null,userID:null,userName:null,path:null,followings:[],myActivityStreamsArea:null,followingsActivityStreamsArea:null,followingsErrorArea:null,actionsErrorArea:null,nameDialogErrorArea:null,activityStreamsErrorArea:null,nameDialog:null,nameDialogLabel:null,objectName:null,objectImage:null,addActivityButton:null,myActivityStreamsAreaCount:0,followingsActivityStreamsAreaCount:0,emptyActivityStreamsAreaHTML:"<tr><td>Activity list is empty</td></tr>",init:function(){this.userID=a("#loggedUserID").val(),this.userName=a("#loggedUserName").val(),this.path=a("#path").val();var b=a("#loggedUserFollowings").val();""!==b&&(this.followings=String(b).split(",")),this.myActivityStreamsArea=a("#myActivityStreams"),this.followingsActivityStreamsArea=a("#friendsActivityStreams"),this.nameDialog=a("#nameDialog"),this.nameDialogLabel=a("#nameDialogLabel"),this.objectName=a("#objectName"),this.objectImage=a("#objectImage"),this.addActivityButton=a("#addActivity"),this.nameDialogErrorArea=a("#nameDialogErrorArea"),this.activityStreamsErrorArea=a("#activityStreamsErrorArea"),this.followingsErrorArea=a("#followingsErrorArea"),this.actionsErrorArea=a("#actionsErrorArea"),this.socket=io.connect(this.path)}},b}(jQuery,app||{}),app=function(a,b){return b.dictionary={verbs:{post:"posted",recommend:"recommended",add:"added"},objectTypes:{photo:"glyphicon-picture",video:"glyphicon-facetime-video",note:"glyphicon-edit",place:"glyphicon-map-marker",audio:"glyphicon-music",like:"glyphicon-heart"},actionHandlers:{httpActionHandler:"HttpActionHandler",viewActionHandler:"ViewActionHandler",embedActionHandler:"EmbedActionHandler",intentActionHandler:"IntentActionHandler"},actions:{see:{objectType:"",url:"/api/see",method:"GET"},share:{objectType:"",url:"/api/share",method:"GET"}},init:function(){for(var a in this.actions)this.actions.hasOwnProperty(a)&&(this.actions[a].objectType=this.actionHandlers.httpActionHandler,this.actions[a].url=app.common.path+this.actions[a].url)}},b}(jQuery,app||{}),app=function(a,b){return b.followings={addOrRemove:function(){var b=a(this),c=b.find("[id^='followingID']").val(),d=b.find("[id^='isFollowed']"),e="true"===d.val(),f=e?"DELETE":"POST",g=b.parent().parent();a.ajax({url:"/users/"+app.common.userID+"/followings/"+c,type:f,success:function(a){if(a.success){if(app.common.followingsErrorArea.parent().addClass("hidden"),e){var f=app.common.followings.indexOf(c);app.common.followings.splice(f,1),d.val("false"),b.attr("title","Follow");var h=app.common.followingsActivityStreamsArea.find("tr").filter(":has(input[value='"+c+"'])"),i=h.size();h.remove(),app.common.followingsActivityStreamsAreaCount-=i,0===app.common.followingsActivityStreamsAreaCount&&app.common.followingsActivityStreamsArea.html(app.common.emptyActivityStreamsAreaHTML)}else app.common.followings.push(c),d.val("true"),b.attr("title","Unfollow"),app.activityStreams.displayActivityStreams(app.common.followingsActivityStreamsArea,c,!1);b.find("span").toggleClass("glyphicon-plus").toggleClass("glyphicon-minus"),g.toggleClass("info").toggleClass("success")}else app.common.followingsErrorArea.text(a.error).parent().removeClass("hidden")},error:function(){app.common.followingsErrorArea.text("Unexpected error occured.").parent().removeClass("hidden")}})}},b}(jQuery,app||{});!function(a){a(document).ready(function(){app.common.init(),app.dictionary.init(),app.common.socket.on("clientConnected",function(){app.common.socket.emit("clientSendsData",app.common.userID)}),app.common.socket.on("followingAddedActivity",function(a){app.activityStreams.prependActivity(app.common.followingsActivityStreamsArea,a,app.common.followingsActivityStreamsArea.find("tr").size())}),a("button[id^='follow']").click(app.followings.addOrRemove),a("#postPhoto").click(app.actions.postPhoto),a("#postVideo").click(app.actions.postVideo),a("#postNote").click(app.actions.postNote),a("#recommendPlace").click(app.actions.recommendPlace),a("#postAudio").click(app.actions.postAudio),a("#addLike").click(app.actions.addLike),app.activityStreams.displayActivityStreams(app.common.myActivityStreamsArea,app.common.userID,!0),app.common.followings.length>0&&app.activityStreams.displayActivityStreams(app.common.followingsActivityStreamsArea,app.common.followings.join(),!0)})}(jQuery);