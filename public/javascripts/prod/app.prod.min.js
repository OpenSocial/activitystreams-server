var app=function(a,b){var c=function(b,c){var d=function(b){a.ajax({url:"/activitystreams/"+app.common.userID,type:"POST",data:b,success:function(a){a.success?(b.actor={id:app.common.userID,name:app.common.userName},b._id=a.activityID,app.activityStreams.prependActivity(app.common.myActivityStreamsArea,b,app.common.myActivityStreamsArea.find("tr").size())):app.common.actionsErrorArea.text(a.error).parent().toggleClass("hidden")},error:function(){app.common.actionsErrorArea.text("Unexpected error occured.").parent().toggleClass("hidden")}})},e=function(){var a=app.common.objectName.val();if(a=a.replace(/\\/gm,"\\").replace(/"/gm,'"'),""!==a){var e=(asms.Activity({verb:"post",actor:"acct:joe@example.org",object:"http://example.org/notes/1",testField:"ololo"}),asms.Activity({verb:b,published:new Date,object:{type:c,name:a}})),f=e.__wrapped__;d(f),app.common.nameDialog.modal("hide"),app.common.addActivityButton.off("click")}else app.common.nameDialogErrorArea.text("Please, enter the name to proceed").parent().removeClass("hidden")},f=function(){var a=app.dictionary.verbs[b];app.common.nameDialogLabel.text("like"===c?"Please, enter the name of the object you "+a+" "+c+" to":"Please, enter the name of the "+c+" you "+a),app.common.objectImage.removeClass().addClass("glyphicon "+app.dictionary.objectTypes[c]),app.common.objectName.val(""),app.common.nameDialogErrorArea.parent().addClass("hidden"),app.common.nameDialog.modal(),app.common.addActivityButton.on("click",e)};f()};return b.actions={postPhoto:function(){c("post","photo")},postVideo:function(){c("post","video")},postNote:function(){c("post","note")},recommendPlace:function(){c("recommend","place")},postAudio:function(){c("post","audio")},addLike:function(){c("add","like")}},b}(jQuery,app||{}),app=function(a,b){var c=function(b,c,d){b===app.common.myActivityStreamsArea?(0===app.common.myActivityStreamsAreaCount&&b.empty(),app.common.myActivityStreamsAreaCount++):b===app.common.followingsActivityStreamsArea&&(0===app.common.followingsActivityStreamsAreaCount&&b.empty(),app.common.followingsActivityStreamsAreaCount++);var e="<tr class='success'><input type='hidden' id='actorID"+d+"' value='"+c.actor.id+"'><td><div class='row'><div class='col-md-1'><span class='glyphicon "+app.dictionary.objectTypes[c.object.type]+"'></span></div><div class='col-md-2'><small><abbr class='timeago' title='"+new Date(c.published).toISOString()+"'></abbr></small></div><div class='col-md-9'><strong>"+c.actor.name+"</strong> "+app.dictionary.verbs[c.verb]+" <strong>"+c.object.type+'</strong> "'+c.object.name+'"</div></div></td></tr>';b.prepend(e),setTimeout(function(){a("input[id='actorID"+d+"']").parent().removeClass("success")},3e3),a("abbr.timeago").timeago()},d=function(a,b){for(var d=0,e=b.items.length;e>d;d++){var f=b.items[d];c(a,f,d)}};return b.activityStreams={prependActivity:c,displayActivityStreams:function(b,c,e){a.ajax({url:"/activitystreams/"+c,type:"GET",success:function(a){a.success?a.items.length>0&&(e&&b.empty(),d(b,a)):app.common.activityStreamsErrorArea.text(a.error).parent().toggleClass("hidden")},error:function(){app.common.activityStreamsErrorArea.text("Unexpected error occured.").parent().toggleClass("hidden")}})}},b}(jQuery,app||{}),app=function(a,b){return b.common={userID:null,userName:null,path:null,followings:[],followingsErrorArea:null,actionsErrorArea:null,nameDialog:null,nameDialogLabel:null,objectName:null,objectImage:null,addActivityButton:null,nameDialogErrorArea:null,activityStreamsErrorArea:null,myActivityStreamsArea:null,myActivityStreamsAreaCount:0,followingsActivityStreamsArea:null,followingsActivityStreamsAreaCount:0,emptyActivityStreamsAreaHTML:"<tr><td>Activity list is empty</td></tr>",init:function(){this.userID=a("#loggedUserID").val(),this.userName=a("#loggedUserName").val(),this.path=a("#path").val();var b=a("#loggedUserFollowings").val();""!==b&&(this.followings=String(b).split(",")),this.followingsErrorArea=a("#followingsErrorArea"),this.actionsErrorArea=a("#actionsErrorArea"),this.nameDialog=a("#nameDialog"),this.nameDialogLabel=a("#nameDialogLabel"),this.objectType=a("#objectType"),this.objectName=a("#objectName"),this.objectImage=a("#objectImage"),this.addActivityButton=a("#addActivity"),this.nameDialogErrorArea=a("#nameDialogErrorArea"),this.activityStreamsErrorArea=a("#activityStreamsErrorArea"),this.myActivityStreamsArea=a("#myActivityStreams"),this.followingsActivityStreamsArea=a("#friendsActivityStreams")}},b}(jQuery,app||{}),app=function(a,b){return b.dictionary={verbs:{post:"posted",recommend:"recommended",add:"added"},objectTypes:{photo:"glyphicon-picture",video:"glyphicon-facetime-video",note:"glyphicon-edit",place:"glyphicon-map-marker",audio:"glyphicon-music",like:"glyphicon-heart"}},b}(jQuery,app||{}),app=function(a,b){return b.followings={addOrRemove:function(){var b=a(this),c=b.find("[id^='followingID']").val(),d=b.find("[id^='isFollowed']"),e="true"===d.val(),f=e?"DELETE":"POST",g=b.parent().parent();a.ajax({url:"/users/"+app.common.userID+"/followings/"+c,type:f,success:function(a){if(a.success){if(e){var f=app.common.followings.indexOf(c);app.common.followings.splice(f,1),d.val("false"),b.attr("title","Follow");var h=app.common.followingsActivityStreamsArea.find("tr").filter(":has(input[value='"+c+"'])"),i=h.size();h.remove(),app.common.followingsActivityStreamsAreaCount-=i,0===app.common.followingsActivityStreamsAreaCount&&app.common.followingsActivityStreamsArea.html(app.common.emptyActivityStreamsAreaHTML)}else app.common.followings.push(c),d.val("true"),b.attr("title","Unfollow"),app.activityStreams.displayActivityStreams(app.common.followingsActivityStreamsArea,c,!1);b.find("span").toggleClass("glyphicon-plus").toggleClass("glyphicon-minus"),g.toggleClass("info").toggleClass("success")}else app.common.followingsErrorArea.text(a.error).parent().toggleClass("hidden")},error:function(){app.common.followingsErrorArea.text("Unexpected error occured.").parent().toggleClass("hidden")}})}},b}(jQuery,app||{});!function(a){a(document).ready(function(){app.common.init();var b=io.connect(app.common.path);b.on("activityAdded",function(a,b){b.followers.indexOf(app.common.userID)>=0&&app.activityStreams.prependActivity(app.common.followingsActivityStreamsArea,a,app.common.followingsActivityStreamsArea.find("tr").size())}),a("button[id^='follow']").click(app.followings.addOrRemove),a("#postPhoto").click(app.actions.postPhoto),a("#postVideo").click(app.actions.postVideo),a("#postNote").click(app.actions.postNote),a("#recommendPlace").click(app.actions.recommendPlace),a("#postAudio").click(app.actions.postAudio),a("#addLike").click(app.actions.addLike),app.activityStreams.displayActivityStreams(app.common.myActivityStreamsArea,app.common.userID,!0),app.common.followings.length>0&&app.activityStreams.displayActivityStreams(app.common.followingsActivityStreamsArea,app.common.followings.join(),!0)})}(jQuery);